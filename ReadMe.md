# MyOS

## Обзор проекта

MyOS - это современная учебная операционная система с полной реализацией ELF-загрузчика. Система способна загружать и выполнять ELF-программы в пользовательском режиме с полной изоляцией памяти и защитой привилегий.

## Ключевые возможности

### ELF-загрузчик
- **Полная поддержка ELF32** - парсинг заголовков, сегментов, секций
- **Валидация формата** - проверка магических чисел, архитектуры, типов файлов
- **Загрузка в память** - размещение сегментов по виртуальным адресам
- **Интеграция с планировщиком** - создание задач из ELF-программ

### Многозадачность
- **Планировщик Round-Robin** - справедливое распределение процессорного времени
- **Переключение контекста** - атомное сохранение/восстановление состояния регистров
- **Пользовательский режим** - Ring 3 с защитой памяти
- **Системные вызовы** - INT 0x80 интерфейс для взаимодействия с ядром

### Управление памятью
- **Простой аллокатор** - динамическое выделение памяти в куче
- **Виртуальная память** - поддержка paging для изоляции процессов
- **Защита памяти** - разграничение между режимами ядра и пользователя

### Файловая система
- **В памяти** - простая файловая система для хранения ELF-программ
- **Операции с файлами** - создание, чтение, запись, удаление
- **Интеграция с ELF** - загрузка программ из файловой системы

## Архитектура

### Структура проекта
```
src/
├── boot/boot.asm           # Multiboot загрузчик
├── kernel/
│   ├── kernel.c           # Основное ядро с интеграцией ELF
│   ├── elf_loader.c       # ELF-загрузчик
│   ├── interrupts.asm     # Обработчики прерываний
│   ├── context.asm        # Переключение контекста
│   ├── syscalls.asm       # Системные вызовы
│   └── usermode.asm       # Пользовательский режим
├── include/
│   ├── elf.h             # ELF структуры и константы
│   └── types.h           # Базовые типы данных
└── linker.ld             # Скрипт линковщика
```

### ELF-загрузчик

#### Компоненты
1. **Валидация** - проверка корректности ELF-файла
2. **Парсинг** - разбор заголовков и сегментов
3. **Загрузка** - размещение программы в памяти
4. **Создание задачи** - интеграция с планировщиком

#### Поддерживаемые форматы
- ELF32 (32-битные исполняемые файлы)
- Little Endian архитектура
- i386 (Intel 80386) процессоры
- Исполняемые файлы (ET_EXEC)

#### Алгоритм загрузки
1. Валидация магических чисел и заголовков
2. Парсинг program headers для загружаемых сегментов
3. Выделение памяти под программу
4. Копирование сегментов из файла в память
5. Инициализация BSS секций (обнуление)
6. Создание пользовательской задачи с точкой входа

## Командная оболочка

### Системные команды
- `help` - список доступных команд
- `about` - информация о системе
- `clear` - очистка экрана
- `memory` - состояние памяти
- `tasks` - список активных задач

### ELF-команды
- `testelf` - тест загрузчика с встроенной программой
- `run <filename>` - загрузка и запуск ELF-программы из файла
- `touch <filename>` - создание файла
- `ls` - список файлов в системе

## Системные вызовы

Поддерживаемые через INT 0x80:
- `SYS_EXIT` (0) - завершение процесса
- `SYS_WRITE` (1) - вывод данных
- `SYS_GETPID` (8) - получение ID процесса
- `SYS_YIELD` (9) - передача управления планировщику

## Сборка и запуск

### Требования
- NASM (ассемблер)
- GCC с поддержкой i386
- GNU LD (линковщик)
- GRUB (для ISO образа)
- QEMU (эмулятор)

### Команды сборки
```bash
make all       # Полная сборка ISO образа
make kernel    # Только ядро
make run-iso   # Запуск в QEMU
make clean     # Очистка
```

## Последние изменения

### 2025-09-04: Полная интеграция ELF-загрузчика
- ✅ **Завершен полный ELF-загрузчик** - полностью интегрирован в ядро
- ✅ **Валидация ELF32** - проверка магических чисел, архитектуры, типов
- ✅ **Загрузка программ** - размещение сегментов по виртуальным адресам  
- ✅ **Интеграция с планировщиком** - создание пользовательских задач из ELF
- ✅ **Команды оболочки** - `testelf` и `run <filename>` для тестирования
- ✅ **Файловая система** - загрузка ELF-программ из файлов
- ✅ **Готовый к работе** - система скомпилирована и запущена

## Пользовательские предпочтения

- Язык интерфейса: русский
- Стиль кодирования: строгий C99 с комментариями
- Архитектура: модульная с четким разделением ответственности
- Отладка: подробные сообщения об ошибках и состоянии системы

## Проектная архитектура

### Уровни системы
1. **Аппаратный уровень** - прямое взаимодействие с железом
2. **Уровень ядра** - управление памятью, задачами, прерываниями  
3. **Уровень системных вызовов** - интерфейс между ядром и программами
4. **Уровень приложений** - ELF-программы в пользовательском режиме

### Безопасность
- Валидация всех входных ELF-данных
- Проверка границ памяти при загрузке
- Изоляция пользовательских процессов
- Защита критических структур ядра

## Дальнейшее развитие

Потенциальные улучшения:
- Поддержка динамических библиотек (ET_DYN)
- Релокация и связывание во время выполнения
- Отладочная информация (DWARF)
- Межпроцессное взаимодействие (IPC)
- Сетевые возможности и драйверы устройств